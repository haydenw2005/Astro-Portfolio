---
import type { ImageMetadata } from 'astro';
import { getImage } from "astro:assets";
import AboutMe from '../components/AboutMe';
import { DynamicStars } from '../components/DynamicStars';
import Welcome from '../components/Welcome';
import meImages from "../constants/Me_Images.json";
import { techIcons } from '../constants/TechIcons';
import Layout from '../layouts/Layout.astro';

// Import all images
const allImages = await Astro.glob<{ default: ImageMetadata }>('/src/assets/**/*.(png|svg|jpg|jpeg|webp)');

console.log('All Images:', allImages.map(img => img.default.src));

// Filter for tech icons
const techIconImages = allImages.filter(img => img.default.src.includes('/TechIcons/'));

// Filter for Me images
const meImageFiles = allImages.filter(img => img.default.src.includes('/Me/'));

// Use the images
const optimizedTechIcons = await Promise.all(techIcons.map(async (icon) => {
  const imageModule = techIconImages.find(img => img.default.src.includes(icon.src));
  
  if (!imageModule) {
    console.error('Image not found:', icon.src);
    return { ...icon, optimizedSrc: '' };
  }

  try {
    const optimizedImage = await getImage({
      src: imageModule.default,
      format: 'webp',
      width: 100
    });
    return { ...icon, optimizedSrc: optimizedImage.src };
  } catch (error) {
    console.error('Error processing icon:', icon.src, error);
    return { ...icon, optimizedSrc: '' };
  }
}));

// Process Me images
const optimizedMeImages = await Promise.all(meImages.map(async (imagePath) => {
  const imageModule = meImageFiles.find(img => img.default.src.includes(imagePath));
  
  if (!imageModule) {
    console.error('Image not found:', imagePath);
    return { original: imagePath, optimizedSrc: '' };
  }

  try {
    const optimizedImage = await getImage({
      src: imageModule.default,
      format: 'webp',
      width: 300
    });
    return { original: imagePath, optimizedSrc: optimizedImage.src };
  } catch (error) {
    console.error('Error processing image:', imagePath, error);
    return { original: imagePath, optimizedSrc: '' };
  }
}));

---

<Layout title="Hayden White" description="Explore the digital world of Hayden White.">
	<DynamicStars client:load />
	<section id="welcome">
		<div class="mx-auto p-4 max-w-[80%] md:max-w-[50%] text-white text-xl leading-relaxed flex items-center min-h-screen ">
			<Welcome />
		</div>
	</section>
	<section id="about-me" >
		<div class="overflow-hidden">
			<div class="mx-auto p-4  max-w-[80%] text-white text-xl leading-relaxed flex items-center min-h-screen">
				<AboutMe client:visible optimizedTechIcons={optimizedTechIcons} optimizedMeImages={optimizedMeImages}>
				</AboutMe>
			</div>
		</div>
	</section>
	<section id="projects">

	</section>
	<section id="interests">
		
	</section>

	<section id="contact"></section>
</Layout>

