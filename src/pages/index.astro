---
import AboutMe from '../components/AboutMe';
import { DynamicStars } from '../components/DynamicStars';
import Projects from '../components/Projects';
import Welcome from '../components/Welcome';
import meImages from "../constants/Me_Images.json";
import { techIcons } from '../constants/TechIcons';
import Layout from '../layouts/Layout.astro';
import { optimizeImage } from "../utils/ImageOptimization";

// Import all tech icons statically

const techIconImages = await Astro.glob<{ default: ImageMetadata }>('../images/TechIcons/*.(png|svg|jpg|jpeg|webp)');
const meImageFiles = await Astro.glob<{ default: ImageMetadata }>('../images/Me/*.(png|jpg|jpeg|webp)');

const optimizedTechIcons = await Promise.all(
  techIcons.map(async (icon) => {
    const optimized = await optimizeImage(icon, techIconImages, { width: 50, format: 'webp' });
    return { ...icon, optimizedSrc: optimized.optimizedSrc };
  })
);
const optimizedMeImages = await Promise.all(
  meImages.map(async (image, index) => {
    const optimized = await optimizeImage(image, meImageFiles, { width: 300, format: 'webp' });
    return { src: image, optimizedSrc: optimized.optimizedSrc, alt: `Me Image ${index}` };
  })
);

const props = Astro?.locals?.netlify?.context;
console.log(props);

---

<Layout title="Hayden White" description="Explore the digital world of Hayden White">
  <div class="relative">
    <DynamicStars client:load/>
    <div class="relative z-10">
      <section id="welcome">
        <div class="mx-auto p-4 max-w-[90%] left-[10%] md:max-w-[50%] text-white text-xl leading-relaxed flex items-center min-h-screen">
          <Welcome />
        </div>
      </section>
      <section id="about-me" >
        <div class="overflow-hidden">
          <div class="mx-auto p-4  max-w-[80%] text-white text-xl leading-relaxed flex items-center min-h-screen">
            <AboutMe client:visible optimizedTechIcons={optimizedTechIcons} optimizedMeImages={optimizedMeImages}>
            </AboutMe>
          </div>
        </div>
      </section>
      <section id="projects">
        <Projects client:visible />
      </section>
      <section id="interests">
        
      </section>

      <section id="contact"></section>
    </div>
  </div>
</Layout>

<style>
  .relative {
    position: relative;
  }
  .fixed {
    position: fixed;
  }
  .inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
  .z-0 {
    z-index: 0;
  }
  .z-10 {
    z-index: 10;
  }
</style>

